<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>One Minute Server</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="One Minute Server">
<meta property="og:url" content="http://hbreinecke.github.io/index.html">
<meta property="og:site_name" content="One Minute Server">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="One Minute Server">
  
    <link rel="alternate" href="/atom.xml" title="One Minute Server" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">One Minute Server</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://hbreinecke.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Simple-File-Transfer-With-OneMinuteServer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/13/Simple-File-Transfer-With-OneMinuteServer/" class="article-date">
  <time datetime="2017-04-13T17:33:39.000Z" itemprop="datePublished">2017-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/13/Simple-File-Transfer-With-OneMinuteServer/">Simple-File-Transfer-With-OneMinuteServer</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="The-Simple-File-Transfer-Java-Application"><a href="#The-Simple-File-Transfer-Java-Application" class="headerlink" title="The Simple-File-Transfer Java Application"></a>The Simple-File-Transfer Java Application</h1><h2 id="The-Idea"><a href="#The-Idea" class="headerlink" title="The Idea"></a>The Idea</h2><p>The idea is to use the OneMinuteServer to transfer files from A to B.<br>There are some special reasons why you use this instead of other solutions.</p>
<ul>
<li>It is easy to use. One Click, and it is working (If the Directory exists.)</li>
<li>It´s using normal Http-Ports.</li>
<li>The file is nowhrere stored in complete. Just parts for a minute on the OneMinuteServer.## How it works</li>
<li>If you select a file to send, the file will be splitted in parts, each 1000 bytes. And send to the server, one by one. With a short delay. Maybe the transfer of the file last a few seconds, or minutes. Depending on the size. </li>
<li>If you select Receive, the server is asked every few seconds, if there is a file available. If there is a file, the parts are fetched, one or more parts at a time. If the file is complete, it is written to the desination-directory.</li>
</ul>
<p>More than one person can receive at a time, and more than one can send.<br>For example, if you have 10 friends, you can send them all a file at once.<br>It´s important to have the same clientid, which is like a key on the server.</p>
<p>With this simple version, you should not send and receive at the same time.<br>Next project will have more possibilities.</p>
<h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p><img src="/images/simplefiletransfer.png" alt="Overview"></p>
<h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source-Code"></a>Source-Code</h3><p>Find it on github: <a href="https://github.com/hbreinecke/simple-file-transfer" target="_blank" rel="external">https://github.com/hbreinecke/simple-file-transfer</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hbreinecke.github.io/2017/04/13/Simple-File-Transfer-With-OneMinuteServer/" data-id="cj1gr3363000248pv12k1gej3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-like-web-analytics" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/28/like-web-analytics/" class="article-date">
  <time datetime="2017-03-28T18:53:34.000Z" itemprop="datePublished">2017-03-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/28/like-web-analytics/">like-web-analytics</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="See-how-it-works"><a href="#See-how-it-works" class="headerlink" title="See how it works"></a>See how it works</h1><p>Now we are going to see how live data can be requested from the one-minute-server and analyzed.</p>
<h2 id="Get-this-thing-started"><a href="#Get-this-thing-started" class="headerlink" title="Get this thing started"></a>Get this thing started</h2><p><img src="/images/like-web-analytics1.png" alt="like-web-analytics"><br>Here you see the default view with no data available.<br>To request data from the server you have to push the start-button. Press it now.<br>It makes sense to have differnt times, because request time should not be over 60 seconds, but display time you can have 2 minutes, if its ok for your application.<br>In the config-view you can set the sever (here my demo-appliance) and how often the data should be requested and the data sould be updated in the view.<br>In the demo-panel you can choose different things</p>
<ul>
<li><p>There are differnt labels a user can go to in this demo-shop</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> labels = [</div><div class="line">  &#123;<span class="string">"category"</span> : <span class="string">"Startseite"</span>, <span class="string">"content"</span> : <span class="string">"Start"</span>, <span class="string">"campaign"</span> : <span class="string">"Google1"</span>&#125;,</div><div class="line">  &#123;<span class="string">"category"</span> : <span class="string">"Startseite/Auto &amp; Motorrad/KFZ-Ersatzteile/Scheibenreinigung/Scheibenwischer"</span>, <span class="string">"content"</span> : <span class="string">"Überblick"</span> &#125;,</div><div class="line">  &#123;<span class="string">"category"</span> : <span class="string">"Startseite/Auto &amp; Motorrad/KFZ-Ersatzteile"</span>, <span class="string">"content"</span> : <span class="string">"Kategorie Überblick"</span> &#125;,</div><div class="line">  &#123;<span class="string">"category"</span> : <span class="string">"Startseite/Elektronik &amp; Computer/Unterhaltungselektronik/Foto &amp; Video"</span>,<span class="string">"content"</span> : <span class="string">"Kategorie Überblick"</span> &#125;,</div><div class="line">  &#123;<span class="string">"category"</span> : <span class="string">"Startseite/Elektronik &amp; Computer/Unterhaltungselektronik/TV, Audio &amp; Video/Fernseher &amp; ZubehörFernseher"</span>, <span class="string">"content"</span> : <span class="string">"Telefunken Full HD LED TV 102cm"</span>&#125;,</div><div class="line">  ....</div></pre></td></tr></table></figure>
</li>
<li><p>Type of shopper :<br>… a person visiting random pages from the list<br>… a person visiting the pages in the the natural order<br>… 10 persons visiting random pages<br>… 100 persons visiting random pages</p>
</li>
<li><p>Pause between request 1/8 second, 1/4 second,.. till random 5-20 Seconds</p>
</li>
<li><p>How much requests are send (5,10,..10000 )</p>
</li>
<li><p>and a request down-counter</p>
</li>
</ul>
<p>You have got to press start to send requests. Press it now.</p>
<p>A few moments later, denpending on your settings, you see this:<br><img src="/images/like-web-analytics2.png" alt="like-web-analytics 2"></p>
<p>It you let this run for a while, you will see the requests disapear from the last minute.<br>On the right side you see the top 5 content requests since the app loaded. They will not dissapear after a minute. They stay till you close the browser, or hit F5.</p>
<h2 id="The-Code-in-analytics-js"><a href="#The-Code-in-analytics-js" class="headerlink" title="The Code in analytics.js"></a>The Code in analytics.js</h2><p>After hitting the start-button, the function “start” is called<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  dataworld.timer1 = <span class="built_in">window</span>.setInterval(fetchData, <span class="built_in">document</span>.getElementById(<span class="string">"fetchtime"</span>).value *<span class="number">1000</span>);</div><div class="line">  dataworld.timer2 = <span class="built_in">window</span>.setInterval(displayData, <span class="built_in">document</span>.getElementById(<span class="string">"updatetime"</span>).value *<span class="number">1000</span>);</div><div class="line">  dataworld.serverurl = <span class="built_in">document</span>.getElementById(<span class="string">"server"</span>).value;</div><div class="line">  dataworld.clientid = <span class="built_in">document</span>.getElementById(<span class="string">"clientid"</span>).value;</div><div class="line">  dataworld.lastfetchtime=<span class="number">0</span>;</div><div class="line">  dataworld.databaseexist=<span class="literal">false</span>;</div><div class="line">  dataworld.numericfields=[<span class="string">"day"</span>,<span class="string">"month"</span>,<span class="string">"year"</span>,<span class="string">"hour"</span>,<span class="string">"minute"</span>,<span class="string">"second"</span>,<span class="string">"timestamp"</span>,<span class="string">"deletetime"</span>];</div><div class="line">  dataworld.currentpage=<span class="number">1</span>;</div><div class="line">  dataworld.databasecolumns=[];</div><div class="line">  ...</div></pre></td></tr></table></figure></p>
<p>Which sets a fetch-timer and a display-timer<br>The function fetchData gets data from the server and call processData()<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchData</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> dparam = &#123;&#125;;</div><div class="line">  dparam.clientid= dataworld.clientid;</div><div class="line">  dparam.lastfetchtime = dataworld.lastfetchtime;</div><div class="line">  dparam.clienttime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</div><div class="line"></div><div class="line">  $.ajax(&#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">"GET"</span>,</div><div class="line">    <span class="attr">crossDomain</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">url</span>: dataworld.serverurl + <span class="string">"?l="</span>+ b64EncodeUnicode(<span class="built_in">JSON</span>.stringify(dparam)),</div><div class="line">    <span class="attr">dataType</span>: <span class="string">"text"</span>,</div><div class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(data.length &gt; <span class="number">0</span>)&#123;</div><div class="line">        statusmessage(<span class="string">"Recieved Chars "</span> + data.length);</div><div class="line">        processData(data);</div><div class="line">    &#125;</div><div class="line">    ...</div></pre></td></tr></table></figure></p>
<p>In this function the data are splitted into lines and parsed. Neccessary values like time-values are added.<br>If there are new columns, they are added to the database. Database will be created if it doesnt exist.<br>The column names are dynamic and must be the same on the sending client and the sql here.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">processData</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">  <span class="comment">//console.log(data)</span></div><div class="line">  datalines=[]</div><div class="line">  datalines = data.split(<span class="string">"|||"</span>);</div><div class="line">  <span class="keyword">if</span>(datalines.length==<span class="number">0</span>)&#123;<span class="keyword">return</span>&#125;</div><div class="line">  dataworld.currentlines+=datalines.length;</div><div class="line">  $(<span class="string">"#reqreceived"</span>).val( dataworld.currentlines);</div><div class="line">  <span class="comment">//statusmessage("Recieved lines: " +datalines.length);</span></div><div class="line">  <span class="keyword">for</span>(lc <span class="keyword">in</span> datalines)&#123;</div><div class="line">    <span class="keyword">if</span>(datalines[lc].length==<span class="number">0</span>)&#123;<span class="keyword">break</span>;&#125;</div><div class="line">    <span class="comment">//console.log(datalines[lc]);</span></div><div class="line">    <span class="keyword">var</span> parseddata = <span class="built_in">JSON</span>.parse(datalines[lc]);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> datum = <span class="keyword">new</span> <span class="built_in">Date</span>(parseddata.trackingtime);</div><div class="line">    parseddata.year = datum.getFullYear();</div><div class="line">    parseddata.month= datum.getMonth();</div><div class="line">    parseddata.day = datum.getUTCDate();</div><div class="line">    parseddata.hour= datum.getHours();</div><div class="line">    parseddata.minute= datum.getMinutes();</div><div class="line">    parseddata.second = datum.getSeconds();</div><div class="line">    parseddata.datum = twoDigits(parseddata.hour) + <span class="string">":"</span> + twoDigits(parseddata.minute) + <span class="string">":"</span> + twoDigits(parseddata.second );</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(dataworld.databaseexist== <span class="literal">false</span>)&#123;</div><div class="line">      createDatabase(parseddata);</div><div class="line">      dataworld.databaseexist= <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(parseddata.timestamp &gt; dataworld.lastfetchtime)&#123;</div><div class="line">      dataworld.lastfetchtime = parseddata.timestamp;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> inssql = <span class="string">"insert into rawdata ("</span>  ;</div><div class="line">    <span class="keyword">var</span> colstring=<span class="string">""</span>;</div><div class="line">    checkDatabaseColumns(parseddata);</div><div class="line">    <span class="keyword">for</span>(ind <span class="keyword">in</span> parseddata)&#123; </div><div class="line">      <span class="keyword">var</span> k = colstring.length==<span class="string">""</span> ? <span class="string">""</span> : <span class="string">","</span>;</div><div class="line">      colstring+= k+<span class="string">" "</span> + ind;</div><div class="line">    &#125;</div><div class="line">    inssql += colstring + <span class="string">") values ("</span>;</div><div class="line">    colstring=<span class="string">""</span>;</div><div class="line">    <span class="keyword">for</span>(ind <span class="keyword">in</span> parseddata)&#123;</div><div class="line">      <span class="keyword">var</span> k = colstring.length==<span class="string">""</span> ? <span class="string">""</span> : <span class="string">","</span>;</div><div class="line">      <span class="keyword">if</span>(dataworld.numericfields.includes(ind))&#123;</div><div class="line">        colstring+= k +<span class="string">" "</span> + parseddata[ind]+<span class="string">""</span>;</div><div class="line">      &#125;<span class="keyword">else</span>&#123;</div><div class="line">        colstring+= k+ <span class="string">"'"</span> + parseddata[ind]+<span class="string">"'"</span> ;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    inssql+=colstring + <span class="string">")"</span>;</div><div class="line">    alasql.exec(inssql);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="Display-results"><a href="#Display-results" class="headerlink" title="Display results"></a>Display results</h2><p>I choosed a simple design (6 displays per page, 2 in a line. id of every element: 1 to 6)<br>For every analyze you have got a sql, a display type and some html/css-properties<br>Get all entries for the current page; execute the sql, put the values in a converter, display it on the right id, ready !<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">displayData</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="comment">//console.log("display");</span></div><div class="line">  <span class="keyword">var</span> analyseLayout=[</div><div class="line">    &#123; <span class="string">"title"</span> : <span class="string">"Last 5 Content from last minute"</span>,</div><div class="line">      <span class="string">"page"</span>  : <span class="number">1</span>,</div><div class="line">      <span class="string">"into"</span> :<span class="string">"1"</span>,</div><div class="line">      <span class="string">"sql"</span> : <span class="string">"Select top 5 content, datum from rawdata where trackingtime &gt; "</span>+ (<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()<span class="number">-60000</span>)  + <span class="string">" order by 2 desc"</span>,</div><div class="line">      <span class="string">"display"</span> : <span class="string">"simpletable"</span>,</div><div class="line">      <span class="string">"heading"</span> : [<span class="string">'Inhalt'</span>,<span class="string">'Zeit'</span>],</div><div class="line">      <span class="string">"dclass"</span>  : <span class="string">".col-md-4"</span></div><div class="line">    &#125;,</div><div class="line">    &#123; <span class="string">"title"</span> : <span class="string">"Top 5 Content "</span>,</div><div class="line">      <span class="string">"page"</span>  : <span class="number">1</span>,</div><div class="line">      <span class="string">"into"</span>  : <span class="string">"2"</span>,</div><div class="line">      <span class="string">"sql"</span> : <span class="string">"Select top 5 content, count(*)  from rawdata group by content order by 2 desc"</span>,</div><div class="line">      <span class="string">"display"</span> : <span class="string">"simpletable"</span>,</div><div class="line">      <span class="string">"heading"</span> : [<span class="string">'Kampange'</span>,<span class="string">'Anzahl'</span>],</div><div class="line">      <span class="string">"dclass"</span>  : <span class="string">".col-md-4"</span></div><div class="line">    &#125;,</div><div class="line">    &#123; <span class="string">"title"</span> : <span class="string">"Anzahl User"</span>,</div><div class="line">      <span class="string">"page"</span>  : <span class="number">1</span>,</div><div class="line">      <span class="string">"into"</span>  : <span class="string">"3"</span>,</div><div class="line">      <span class="string">"sql"</span> : <span class="string">"select count(*) from (Select distinct user from rawdata )"</span>,</div><div class="line">      <span class="string">"display"</span> : <span class="string">"simpletable"</span>,</div><div class="line">      <span class="string">"heading"</span> : [<span class="string">'Benutzer'</span>],</div><div class="line">      <span class="string">"dclass"</span>  : <span class="string">".col-md-4"</span></div><div class="line">    &#125;</div><div class="line">  ];</div><div class="line"></div><div class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> n = <span class="number">1</span>;n &lt;= <span class="number">6</span>; n++ ) &#123;</div><div class="line">      $(<span class="string">"#loc"</span>+ n ).html(<span class="string">"&lt;h3&gt;&lt;a href='#'&gt;&lt;/a&gt;&lt;/h3&gt;"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">for</span>(index <span class="keyword">in</span> analyseLayout)&#123;</div><div class="line">    <span class="keyword">var</span> ana = analyseLayout[index];</div><div class="line">    <span class="keyword">if</span>(ana.page==dataworld.currentpage)&#123;</div><div class="line">      <span class="keyword">var</span> localresult=<span class="string">"&lt;h3&gt;&lt;a href='#'&gt;"</span> +ana.title+ <span class="string">"&lt;/a&gt;&lt;/h3&gt;"</span>;</div><div class="line">      <span class="keyword">var</span> datas =[];</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        datas = alasql.exec(ana.sql);</div><div class="line">        localresult+= converters[ana.display](datas,ana.heading);</div><div class="line">        $(<span class="string">"#loc"</span>+ ana.into ).html(localresult);</div><div class="line">      &#125; <span class="keyword">catch</span>(e)&#123;</div><div class="line">        <span class="built_in">console</span>.log(e);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> converters=[];</div><div class="line">converters[<span class="string">"simpletable"</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">data,head</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> ret = <span class="string">"&lt;table class='table  '&gt; &lt;thead&gt;&lt;tr&gt;"</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> ix <span class="keyword">in</span> head)&#123;ret+=<span class="string">"&lt;th scope='row'&gt;"</span>+head[ix] + <span class="string">"&lt;/th&gt;"</span>&#125;</div><div class="line">    ret+=<span class="string">" &lt;/tr&gt;&lt;/thead&gt;"</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> index <span class="keyword">in</span> data)&#123;</div><div class="line">        ret += <span class="string">"&lt;tr&gt;"</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> na <span class="keyword">in</span> data[index])&#123;</div><div class="line">            ret += <span class="string">"&lt;td&gt;"</span> + data[index][na] + <span class="string">"&lt;/td&gt;"</span></div><div class="line">        &#125;</div><div class="line">        ret += <span class="string">"&lt;/tr&gt;"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ret+<span class="string">"&lt;/table&gt;"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>The converter just puts the values into a html-table and returns the result string.See it all at : <a href="http://light-no.de/apps/like-web-analyze" target="_blank" rel="external">http://light-no.de/apps/like-web-analyze</a></p>
<p>See it all at :<br><a href="http://light-no.de/apps/like-web-analyze" target="_blank" rel="external">See it in live action</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hbreinecke.github.io/2017/03/28/like-web-analytics/" data-id="cj1gr336i000648pv1a7w3wkz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Html-Javascript-analyze/">Html Javascript analyze</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Web-Transfer-Javascript" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/Web-Transfer-Javascript/" class="article-date">
  <time datetime="2017-03-20T16:35:45.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/Web-Transfer-Javascript/">Web-Transfer-Javascript</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Transfer-data-from-web-pages"><a href="#Transfer-data-from-web-pages" class="headerlink" title="Transfer data from web-pages"></a>Transfer data from web-pages</h1><h2 id="How-to-use-the-library"><a href="#How-to-use-the-library" class="headerlink" title="How to use the library"></a>How to use the library</h2><p>Include the library and send data:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;script src=<span class="string">"js/transfer.js"</span>&gt;&lt;/script&gt;<span class="string">`</span></div><div class="line">var lightclientid=999; // your individual id on your server</div><div class="line">var jData=&#123;'label':'/MyShop/Start/SomeCategory'&#125;;</div><div class="line">lightspeed.track(jData);</div></pre></td></tr></table></figure></p>
<p>Which values to use : ‘label,name,content,site,pageid,….’ ?<br>You are free to choose whatever you want, except of ‘clientid’, ‘user’ and ‘trackingtime’. They are used internaly.The data you send to the server are returned to the other client and can be processed there. </p>
<h2 id="The-library"><a href="#The-library" class="headerlink" title="The library"></a>The library</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> lightspeed = (<span class="function"><span class="keyword">function</span> (<span class="params">win, doc</span>) </span>&#123;</div><div class="line"><span class="comment">//****************************************************************************</span></div><div class="line"><span class="comment">// start internal functions</span></div><div class="line"><span class="keyword">if</span>(getCookie(<span class="string">"lightuser"</span>)==<span class="string">""</span>)&#123; </div><div class="line">	setCookie(<span class="string">"lightuser"</span>, generateUUID(),<span class="number">1000</span> )</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> lightuser = <span class="built_in">window</span>.lightuser ? <span class="built_in">window</span>.lightuser : getCookie(<span class="string">"lightuser"</span>);</div><div class="line"><span class="keyword">var</span> clientid = <span class="built_in">window</span>.lightclientid ? <span class="built_in">window</span>.lightclientid : <span class="string">"0"</span> ;</div><div class="line"><span class="keyword">var</span> contentObject =&#123;&#125;;</div><div class="line"><span class="comment">//****************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">addimage</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  lightuser = <span class="built_in">window</span>.lightuser ? <span class="built_in">window</span>.lightuser : getCookie(<span class="string">"lightuser"</span>);</div><div class="line">  <span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">"img"</span>);</div><div class="line">  img.id=<span class="string">"pic4711"</span>;</div><div class="line">  <span class="comment">//img.src = getPicServer() +"/" + clientid + "/" + lightuser + "/" + getImageName() +".jpg" + getImageParam();</span></div><div class="line">  <span class="comment">//img.src = getPicServer() +"/" + clientid + "/" + lightuser + "/0.png" + getImageParam();</span></div><div class="line">  img.src = getPicServer() + <span class="string">"/0.png"</span> + getImageParam();</div><div class="line">  img.height = <span class="number">0</span>;</div><div class="line">  img.width = <span class="number">0</span>;</div><div class="line">  img.style.top=<span class="number">0</span>;</div><div class="line">  img.style.right=<span class="number">0</span>;</div><div class="line">  img.onload = loadHandler;</div><div class="line">  <span class="built_in">document</span>.body.appendChild(img);</div><div class="line">&#125;</div><div class="line"><span class="comment">//****************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPicServer</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span>  <span class="string">"http://light-no.de/img"</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//****************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getImageParam</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(!isEmpty(contentObject ))&#123;</div><div class="line">        contentObject.clientid = <span class="built_in">window</span>.lightclientid ? <span class="built_in">window</span>.lightclientid : <span class="string">"0"</span> ;;</div><div class="line">        contentObject.user = lightuser;</div><div class="line">        contentObject.trackingtime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</div><div class="line">		<span class="keyword">var</span> va = <span class="built_in">JSON</span>.stringify(contentObject);</div><div class="line">		<span class="comment">//console.log(contentObject);</span></div><div class="line">		va = b64EncodeUnicode(va);</div><div class="line">		contentObject=&#123;&#125;;</div><div class="line">		<span class="keyword">return</span> <span class="string">"?l="</span> + va + <span class="string">"&amp;t="</span> + rand(<span class="number">1</span>,<span class="number">50000</span>);</div><div class="line">  &#125;	<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">""</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//****************************************************************************</span></div><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">rand</span> (<span class="params">min, max</span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (max - min + <span class="number">1</span>)) + min;</div><div class="line">&#125;</div><div class="line"><span class="comment">//****************************************************************************</span></div><div class="line"><span class="comment">//****************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEmpty</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">   <span class="keyword">for</span> (<span class="keyword">var</span> x <span class="keyword">in</span> obj) &#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</div><div class="line">   <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//***************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadHandler</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="comment">//console.log("image loaded");</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//****************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getURLParameter</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>((<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'[?|&amp;]'</span> + name + <span class="string">'='</span> + <span class="string">'([^&amp;;]+?)(&amp;|#|;|$)'</span>).exec(location.search) || [<span class="literal">null</span>, <span class="string">''</span>])[<span class="number">1</span>].replace(<span class="regexp">/\+/g</span>, <span class="string">'%20'</span>)) || <span class="literal">null</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//***************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">b64EncodeUnicode</span>(<span class="params">str</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> btoa(<span class="built_in">encodeURIComponent</span>(str).replace(<span class="regexp">/%([0-9A-F]&#123;2&#125;)/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">match, p1</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">String</span>.fromCharCode(<span class="string">'0x'</span> + p1);</div><div class="line">    &#125;));</div><div class="line">&#125;</div><div class="line"><span class="comment">//b64EncodeUnicode('? Ã  la mode'); // "4pyTIMOgIGxhIG1vZGU="</span></div><div class="line"><span class="comment">//b64EncodeUnicode('\n'); // "Cg=="</span></div><div class="line"><span class="comment">//***************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">b64DecodeUnicode</span>(<span class="params">str</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(<span class="built_in">Array</span>.prototype.map.call(atob(str), <span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'%'</span> + (<span class="string">'00'</span> + c.charCodeAt(<span class="number">0</span>).toString(<span class="number">16</span>)).slice(<span class="number">-2</span>);</div><div class="line">    &#125;).join(<span class="string">''</span>));</div><div class="line">&#125;</div><div class="line"><span class="comment">//***************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">cname</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> name = cname + <span class="string">"="</span>;</div><div class="line">    <span class="keyword">var</span> decodedCookie = <span class="built_in">decodeURIComponent</span>(<span class="built_in">document</span>.cookie);</div><div class="line">    <span class="keyword">var</span> ca = decodedCookie.split(<span class="string">';'</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;ca.length; i++) &#123;</div><div class="line">        <span class="keyword">var</span> c = ca[i];</div><div class="line">        <span class="keyword">while</span> (c.charAt(<span class="number">0</span>) == <span class="string">' '</span>) &#123;</div><div class="line">            c = c.substring(<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (c.indexOf(name) == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">return</span> c.substring(name.length, c.length);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//***************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">cname, cvalue, exdays</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">    d.setTime(d.getTime() + (exdays*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">1000</span>));</div><div class="line">    <span class="keyword">var</span> expires = <span class="string">"expires="</span>+ d.toUTCString();</div><div class="line">    <span class="built_in">document</span>.cookie = cname + <span class="string">"="</span> + cvalue + <span class="string">";"</span> + expires + <span class="string">";path=/"</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//***************************************************************************</span></div><div class="line"><span class="comment">//http://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateUUID</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">window</span>.performance &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.performance.now === <span class="string">"function"</span>)&#123;</div><div class="line">        d += performance.now(); <span class="comment">//use high-precision timer if available</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> uuid = <span class="string">'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'</span>.replace(<span class="regexp">/[xy]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> r = (d + <span class="built_in">Math</span>.random()*<span class="number">16</span>)%<span class="number">16</span> | <span class="number">0</span>;</div><div class="line">        d = <span class="built_in">Math</span>.floor(d/<span class="number">16</span>);</div><div class="line">        <span class="keyword">return</span> (c==<span class="string">'x'</span> ? r : (r&amp;<span class="number">0x3</span>|<span class="number">0x8</span>)).toString(<span class="number">16</span>);</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> uuid;</div><div class="line">&#125;</div><div class="line"><span class="comment">// end internal function</span></div><div class="line"><span class="comment">//***************************************************************************</span></div><div class="line"><span class="comment">//***************************************************************************</span></div><div class="line"><span class="comment">// return the public methods</span></div><div class="line"><span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">generateUUID</span> :<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> generateUUID();&#125;,</div><div class="line">        <span class="attr">track</span>  : <span class="function"><span class="keyword">function</span> (<span class="params"> param</span>) </span>&#123;</div><div class="line">			contentObject = param;</div><div class="line">			addimage();</div><div class="line">         &#125;</div><div class="line">    &#125;;</div><div class="line"><span class="comment">//***************************************************************************</span></div><div class="line"><span class="comment">//***************************************************************************</span></div><div class="line">&#125;)(<span class="built_in">window</span>, <span class="built_in">document</span>);</div></pre></td></tr></table></figure>
<p>Nothing really hard to get. Anyway, let´s have a look at some parts.<br>The track-function takes a Json-object and calls addimage(); which transforms the value to Base64 and append it as an image to the document.</p>
<p>Before this happens, as visitor-cookie is set to random value. Maybe helpfull to get well-defined users. As a lot of apps can run on one server, it is neccesary to set a clientid. If you request data from the server, you have got to use the same clientid.<br>The created-image-link will be something like:<br><a href="http://light-no.de/img/0.png?l=eyJjYXRlZ29yeSI6IlN0YXJ0c2VpdGUvQXV0byAmIE1vdG9ycmFkL0tGWi1FcnNhdHp0ZWlsZS9TY2hlaWJlbnJlaW5pZ3VuZy9TY2hlaWJlbndpc2NoZXIiLCJjb250ZW50Ijoiw5xiZXJibGljayIsImNsaWVudGlkIjoxMDAwLCJ1c2VyIjoiNTEyOTZlYTMtYzk3My00ZTBiLWFkMjItZGEwMDU2YmVlMzU5IiwidHJhY2tpbmd0aW1lIjoxNDkwMDI5MjE5Mzc0fQ==&amp;t=18162" target="_blank" rel="external">http://light-no.de/img/0.png?l=eyJjYXRlZ29yeSI6IlN0YXJ0c2VpdGUvQXV0byAmIE1vdG9ycmFkL0tGWi1FcnNhdHp0ZWlsZS9TY2hlaWJlbnJlaW5pZ3VuZy9TY2hlaWJlbndpc2NoZXIiLCJjb250ZW50Ijoiw5xiZXJibGljayIsImNsaWVudGlkIjoxMDAwLCJ1c2VyIjoiNTEyOTZlYTMtYzk3My00ZTBiLWFkMjItZGEwMDU2YmVlMzU5IiwidHJhY2tpbmd0aW1lIjoxNDkwMDI5MjE5Mzc0fQ==&amp;t=18162</a></p>
<p>The l-Param contains the data, the t-param is a random number, to avoid caching.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hbreinecke.github.io/2017/03/20/Web-Transfer-Javascript/" data-id="cj1gr336h000548pv68ybl9bi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Library/">Library</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tracking/">Tracking</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Transfer/">Transfer</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Server-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/08/Server-1/" class="article-date">
  <time datetime="2017-03-08T20:58:52.000Z" itemprop="datePublished">2017-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/08/Server-1/">Server Part1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Welcome-to-The-One-Minute-Server"><a href="#Welcome-to-The-One-Minute-Server" class="headerlink" title="Welcome to The One Minute Server"></a>Welcome to The One Minute Server</h1><h2 id="The-Idea"><a href="#The-Idea" class="headerlink" title="The Idea"></a>The Idea</h2><p>The idea is to build something with node.js.<br>I decided to stored objects, just for one minute. What can you do with such a server ?<br>Let´s discover it.</p>
<h3 id="ArchitectureOverview"><a href="#ArchitectureOverview" class="headerlink" title="ArchitectureOverview"></a>ArchitectureOverview</h3><p><img src="/images/ArchitectureOverview.png" alt="Overview"></p>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>You need a node-server running. And you can send Get-requests to the<br>server with objects in the url. e.g. : <a href="http://www.server.com/img/l=Base64Coded-Entity" target="_blank" rel="external">http://www.server.com/img/l=Base64Coded-Entity</a>.<br>And you can get available data from the server: <a href="http://www.server.com/getdata" target="_blank" rel="external">http://www.server.com/getdata</a></p>
<h4 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// most important parts</span></div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line">app.locals.datastore = <span class="keyword">new</span> <span class="built_in">Array</span>();</div><div class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>));</div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'jade'</span>);</div><div class="line">app.use(bodyParser.json());</div><div class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;)); </div><div class="line">app.use(cookieParser());</div><div class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>))); </div><div class="line">app.use(express.static(path.join(__dirname, <span class="string">'applications'</span>))); </div><div class="line">app.use(<span class="string">'/'</span>, index);</div><div class="line">app.use(<span class="string">'/img'</span>, img);</div><div class="line">app.use(<span class="string">'/getdata'</span>, getdata);</div></pre></td></tr></table></figure>
<p>Why “img” as path ? Because the first example dependes on<br>web-tracking, and it is so that you request a pixel from the server with<br>your tracking-request for most tracking solutions. So i went the same way. </p>
<h3 id="The-Img-js"><a href="#The-Img-js" class="headerlink" title="The Img.js"></a>The Img.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> router = express.Router();</div><div class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</div><div class="line"><span class="keyword">var</span> image = fs.readFileSync(<span class="string">'/var/www/html/1px.png'</span>);</div><div class="line"></div><div class="line"><span class="comment">//******************************************************************************</span></div><div class="line">router.get(<span class="string">'/*'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> datum = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">    <span class="keyword">var</span> currentTime =  datum.getTime() ;</div><div class="line">    <span class="keyword">var</span> deleteTime =  currentTime - <span class="number">60000</span>;</div><div class="line">    <span class="keyword">var</span> o = parseUrl(req.url, currentTime );    <span class="comment">// get Information from Url to Json</span></div><div class="line">    storeLocal(o,req);                          <span class="comment">// store data in local array</span></div><div class="line">    cleanUp(deleteTime,req);                    <span class="comment">// delete old data</span></div><div class="line">    res.end(image, <span class="string">'binary'</span>);</div><div class="line">&#125;);</div><div class="line"><span class="comment">//******************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseUrl</span>(<span class="params"> requrl, currentTime </span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> url_parts = url.parse(requrl, <span class="literal">true</span>);</div><div class="line">    <span class="keyword">var</span> query = url_parts.query;</div><div class="line">    <span class="keyword">var</span> b = <span class="keyword">new</span> Buffer(<span class="string">""</span>+query.l, <span class="string">'base64'</span>);</div><div class="line">    <span class="keyword">var</span> o = <span class="built_in">JSON</span>.parse( b.toString());</div><div class="line">    o.timestamp = currentTime;</div><div class="line">    o.pkey = <span class="string">""</span>+currentTime+<span class="string">"_"</span>+o.clientid;</div><div class="line">    <span class="keyword">return</span> o;</div><div class="line">&#125;</div><div class="line"><span class="comment">//******************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">cleanUp</span>(<span class="params">cleanupTime, req</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> temp = [];</div><div class="line">    <span class="keyword">var</span> foundAt =<span class="number">-1</span>;</div><div class="line">    <span class="keyword">for</span>( index <span class="keyword">in</span> req.app.locals.datastore)&#123;</div><div class="line">        <span class="keyword">var</span> objtime = req.app.locals.datastore[index].timestamp;</div><div class="line">        <span class="keyword">if</span>(objtime &lt; cleanupTime)&#123;</div><div class="line">            foundAt = index;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(foundAt &gt; <span class="number">-1</span>)&#123;</div><div class="line">        req.app.locals.datastore = req.app.locals.datastore.slice(foundAt);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//******************************************************************************</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">storeLocal</span>(<span class="params">obj,req</span>)</span>&#123;</div><div class="line">    req.app.locals.datastore.push(obj);</div><div class="line">&#125;</div><div class="line"><span class="comment">//******************************************************************************</span></div></pre></td></tr></table></figure>
<p>I build a small data-transfer-library which you can integrate in any website to send some values. The lib has one function which is “track(JSON-Object)”. More about this in the next posts.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hbreinecke.github.io/2017/03/08/Server-1/" data-id="cj1gr335v000048pvfltczcbc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Server/">Server</a></li></ul>

    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Html-Javascript-analyze/">Html Javascript analyze</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Library/">Library</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Server/">Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tracking/">Tracking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Transfer/">Transfer</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Html-Javascript-analyze/" style="font-size: 10px;">Html Javascript analyze</a> <a href="/tags/Javascript/" style="font-size: 10px;">Javascript</a> <a href="/tags/Library/" style="font-size: 10px;">Library</a> <a href="/tags/Server/" style="font-size: 10px;">Server</a> <a href="/tags/Tracking/" style="font-size: 10px;">Tracking</a> <a href="/tags/Transfer/" style="font-size: 10px;">Transfer</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/04/13/Simple-File-Transfer-With-OneMinuteServer/">Simple-File-Transfer-With-OneMinuteServer</a>
          </li>
        
          <li>
            <a href="/2017/03/28/like-web-analytics/">like-web-analytics</a>
          </li>
        
          <li>
            <a href="/2017/03/20/Web-Transfer-Javascript/">Web-Transfer-Javascript</a>
          </li>
        
          <li>
            <a href="/2017/03/08/Server-1/">Server Part1</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Holger Reinecke<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>